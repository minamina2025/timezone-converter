<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¶åŒºè½¬æ¢å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 24px;
            text-align: center;
            font-size: 1.9em;
        }

        .input-section {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input[type="datetime-local"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="datetime-local"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .city-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .city-selector select {
            flex: 1;
        }

        .remove-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .remove-btn:hover {
            background: #ff3838;
        }

        .add-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .add-btn:hover {
            background: #5568d3;
        }

        .convert-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .convert-btn:active {
            transform: translateY(0);
        }

        .results {
            margin-top: 30px;
            display: none;
        }

        .results.show {
            display: block;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .result-city {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }

        .result-time {
            font-size: 1.6em;
            color: #667eea;
            font-weight: 700;
            line-height: 1.2;
        }

        .result-date {
            color: #666;
            margin-top: 4px;
            font-size: 0.88em;
        }

        .timezone-info {
            color: #888;
            font-size: 0.8em;
            margin-top: 4px;
        }

        .timeline-section {
            margin-top: 30px;
            padding: 20px;
            background: #f6f7fb;
            border-radius: 14px;
            border: 1px solid #e6e7ef;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            color: #444;
            font-weight: 600;
        }

        .timeline-label {
            font-size: 14px;
            color: #666;
        }

        .timeline-display {
            font-size: 16px;
            color: #333;
            font-weight: 700;
        }

        .timeline-slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 10px;
            border-radius: 6px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            outline: none;
            cursor: pointer;
        }

        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            border: 3px solid #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .timeline-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            border: 3px solid #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ æ—¶åŒºè½¬æ¢å™¨</h1>
        
        <div class="input-section">
            <div class="form-group">
                <label for="source-city">æºåŸå¸‚æ—¶åŒºï¼š</label>
                <select id="source-city" required>
                    <option value="">è¯·é€‰æ‹©...</option>
                    <option value="Asia/Shanghai">åŒ—äº¬ (UTC+8)</option>
                    <option value="Asia/Tokyo">ä¸œäº¬ (UTC+9)</option>
                    <option value="Asia/Hong_Kong">é¦™æ¸¯ (UTC+8)</option>
                    <option value="Asia/Singapore">æ–°åŠ å¡ (UTC+8)</option>
                    <option value="Asia/Seoul">é¦–å°” (UTC+9)</option>
                    <option value="America/New_York">çº½çº¦ (UTC-5/-4)</option>
                    <option value="America/Los_Angeles">æ´›æ‰çŸ¶ (UTC-8/-7)</option>
                    <option value="America/Chicago">èŠåŠ å“¥ (UTC-6/-5)</option>
                    <option value="Europe/London">ä¼¦æ•¦ (UTC+0/+1)</option>
                    <option value="Europe/Paris">å·´é» (UTC+1/+2)</option>
                    <option value="Europe/Berlin">æŸæ— (UTC+1/+2)</option>
                    <option value="Europe/Moscow">è«æ–¯ç§‘ (UTC+3)</option>
                    <option value="Australia/Sydney">æ‚‰å°¼ (UTC+10/+11)</option>
                    <option value="Australia/Melbourne">å¢¨å°”æœ¬ (UTC+10/+11)</option>
                    <option value="Pacific/Auckland">å¥¥å…‹å…° (UTC+12/+13)</option>
                    <option value="America/Toronto">å¤šä¼¦å¤š (UTC-5/-4)</option>
                    <option value="America/Vancouver">æ¸©å“¥å (UTC-8/-7)</option>
                    <option value="Asia/Dubai">è¿ªæ‹œ (UTC+4)</option>
                    <option value="Asia/Kolkata">æ–°å¾·é‡Œ (UTC+5:30)</option>
                    <option value="America/Sao_Paulo">åœ£ä¿ç½— (UTC-3)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="source-date">é€‰æ‹©æ—¥æœŸï¼ˆå¯é€‰ï¼Œé»˜è®¤ä»Šå¤©ï¼‰ï¼š</label>
                <input type="date" id="source-date">
            </div>

            <div class="timeline-section">
                <div class="timeline-header">
                    <div class="timeline-label">åœ¨æºåŸå¸‚é€‰æ‹©æ—¶é—´ç‚¹ï¼ˆ24å°æ—¶ï¼Œ15åˆ†é’Ÿåˆ»åº¦ï¼‰</div>
                    <div class="timeline-display" id="timeline-display">--:--</div>
                </div>
                <input type="range" id="timeline-slider" class="timeline-slider" min="0" max="1439" step="15" value="0">
            </div>

            <div class="form-group">
                <label>ç›®æ ‡åŸå¸‚æ—¶åŒºï¼š</label>
                <div id="target-cities">
                    <div class="city-selector">
                        <select class="target-city-select" required>
                            <option value="">è¯·é€‰æ‹©...</option>
                            <option value="Asia/Shanghai">åŒ—äº¬ (UTC+8)</option>
                            <option value="Asia/Tokyo">ä¸œäº¬ (UTC+9)</option>
                            <option value="Asia/Hong_Kong">é¦™æ¸¯ (UTC+8)</option>
                            <option value="Asia/Singapore">æ–°åŠ å¡ (UTC+8)</option>
                            <option value="Asia/Seoul">é¦–å°” (UTC+9)</option>
                            <option value="America/New_York">çº½çº¦ (UTC-5/-4)</option>
                            <option value="America/Los_Angeles">æ´›æ‰çŸ¶ (UTC-8/-7)</option>
                            <option value="America/Chicago">èŠåŠ å“¥ (UTC-6/-5)</option>
                            <option value="Europe/London">ä¼¦æ•¦ (UTC+0/+1)</option>
                            <option value="Europe/Paris">å·´é» (UTC+1/+2)</option>
                            <option value="Europe/Berlin">æŸæ— (UTC+1/+2)</option>
                            <option value="Europe/Moscow">è«æ–¯ç§‘ (UTC+3)</option>
                            <option value="Australia/Sydney">æ‚‰å°¼ (UTC+10/+11)</option>
                            <option value="Australia/Melbourne">å¢¨å°”æœ¬ (UTC+10/+11)</option>
                            <option value="Pacific/Auckland">å¥¥å…‹å…° (UTC+12/+13)</option>
                            <option value="America/Toronto">å¤šä¼¦å¤š (UTC-5/-4)</option>
                            <option value="America/Vancouver">æ¸©å“¥å (UTC-8/-7)</option>
                            <option value="Asia/Dubai">è¿ªæ‹œ (UTC+4)</option>
                            <option value="Asia/Kolkata">æ–°å¾·é‡Œ (UTC+5:30)</option>
                            <option value="America/Sao_Paulo">åœ£ä¿ç½— (UTC-3)</option>
                        </select>
                    </div>
                </div>
                <button type="button" class="add-btn" onclick="addTargetCity()">+ æ·»åŠ ç›®æ ‡åŸå¸‚</button>
            </div>

            <button type="button" class="convert-btn" onclick="convertTime()">è½¬æ¢æ—¶é—´</button>
        </div>

        <div class="results" id="results"></div>
    </div>

    <script>
        const cityNames = {
            'Asia/Shanghai': 'åŒ—äº¬',
            'Asia/Tokyo': 'ä¸œäº¬',
            'Asia/Hong_Kong': 'é¦™æ¸¯',
            'Asia/Singapore': 'æ–°åŠ å¡',
            'Asia/Seoul': 'é¦–å°”',
            'America/New_York': 'çº½çº¦',
            'America/Los_Angeles': 'æ´›æ‰çŸ¶',
            'America/Chicago': 'èŠåŠ å“¥',
            'Europe/London': 'ä¼¦æ•¦',
            'Europe/Paris': 'å·´é»',
            'Europe/Berlin': 'æŸæ—',
            'Europe/Moscow': 'è«æ–¯ç§‘',
            'Australia/Sydney': 'æ‚‰å°¼',
            'Australia/Melbourne': 'å¢¨å°”æœ¬',
            'Pacific/Auckland': 'å¥¥å…‹å…°',
            'America/Toronto': 'å¤šä¼¦å¤š',
            'America/Vancouver': 'æ¸©å“¥å',
            'Asia/Dubai': 'è¿ªæ‹œ',
            'Asia/Kolkata': 'æ–°å¾·é‡Œ',
            'America/Sao_Paulo': 'åœ£ä¿ç½—'
        };

        function addTargetCity() {
            const container = document.getElementById('target-cities');
            const citySelector = document.createElement('div');
            citySelector.className = 'city-selector';
            citySelector.innerHTML = `
                <select class="target-city-select" required>
                    <option value="">è¯·é€‰æ‹©...</option>
                    <option value="Asia/Shanghai">åŒ—äº¬ (UTC+8)</option>
                    <option value="Asia/Tokyo">ä¸œäº¬ (UTC+9)</option>
                    <option value="Asia/Hong_Kong">é¦™æ¸¯ (UTC+8)</option>
                    <option value="Asia/Singapore">æ–°åŠ å¡ (UTC+8)</option>
                    <option value="Asia/Seoul">é¦–å°” (UTC+9)</option>
                    <option value="America/New_York">çº½çº¦ (UTC-5/-4)</option>
                    <option value="America/Los_Angeles">æ´›æ‰çŸ¶ (UTC-8/-7)</option>
                    <option value="America/Chicago">èŠåŠ å“¥ (UTC-6/-5)</option>
                    <option value="Europe/London">ä¼¦æ•¦ (UTC+0/+1)</option>
                    <option value="Europe/Paris">å·´é» (UTC+1/+2)</option>
                    <option value="Europe/Berlin">æŸæ— (UTC+1/+2)</option>
                    <option value="Europe/Moscow">è«æ–¯ç§‘ (UTC+3)</option>
                    <option value="Australia/Sydney">æ‚‰å°¼ (UTC+10/+11)</option>
                    <option value="Australia/Melbourne">å¢¨å°”æœ¬ (UTC+10/+11)</option>
                    <option value="Pacific/Auckland">å¥¥å…‹å…° (UTC+12/+13)</option>
                    <option value="America/Toronto">å¤šä¼¦å¤š (UTC-5/-4)</option>
                    <option value="America/Vancouver">æ¸©å“¥å (UTC-8/-7)</option>
                    <option value="Asia/Dubai">è¿ªæ‹œ (UTC+4)</option>
                    <option value="Asia/Kolkata">æ–°å¾·é‡Œ (UTC+5:30)</option>
                    <option value="America/Sao_Paulo">åœ£ä¿ç½— (UTC-3)</option>
                </select>
                <button type="button" class="remove-btn" onclick="removeTargetCity(this)">åˆ é™¤</button>
            `;
            container.appendChild(citySelector);
        }

        function removeTargetCity(btn) {
            const container = document.getElementById('target-cities');
            if (container.children.length > 1) {
                btn.parentElement.remove();
            } else {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªç›®æ ‡åŸå¸‚ï¼');
            }
        }

        // å°†æºæ—¶åŒºçš„æœ¬åœ°æ—¶é—´è½¬æ¢ä¸ºUTCæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
        function sourceLocalTimeToUTC(year, month, day, hour, minute, sourceTimezone) {
            // ä½¿ç”¨è¿­ä»£æ–¹æ³•æ‰¾åˆ°æ­£ç¡®çš„UTCæ—¶é—´
            // æ€è·¯ï¼šæ‰¾åˆ°ä¸€ä¸ªUTCæ—¶é—´ï¼Œä½¿å¾—å®ƒåœ¨æºæ—¶åŒºä¸­æ˜¾ç¤ºä¸ºè¾“å…¥çš„æ—¥æœŸæ—¶é—´
            
            // å…ˆåˆ›å»ºä¸€ä¸ªDateå¯¹è±¡ï¼ˆæµè§ˆå™¨æœ¬åœ°æ—¶åŒºï¼‰ï¼Œä½œä¸ºåˆå§‹ä¼°è®¡
            const localDate = new Date(year, month, day, hour, minute);
            const localOffsetMinutes = localDate.getTimezoneOffset();
            let utcTime = localDate.getTime() + (localOffsetMinutes * 60000);
            
            // ä½¿ç”¨Intl APIæ ¼å¼åŒ–å™¨
            const sourceFormatter = new Intl.DateTimeFormat('en', {
                timeZone: sourceTimezone,
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
            
            // è¿­ä»£è°ƒæ•´ï¼Œç›´åˆ°æ‰¾åˆ°æ­£ç¡®çš„UTCæ—¶é—´
            for (let i = 0; i < 5; i++) {
                const testDate = new Date(utcTime);
                const sourceParts = sourceFormatter.formatToParts(testDate);
                
                const sourceYear = parseInt(sourceParts.find(p => p.type === 'year').value);
                const sourceMonth = parseInt(sourceParts.find(p => p.type === 'month').value) - 1;
                const sourceDay = parseInt(sourceParts.find(p => p.type === 'day').value);
                const sourceHour = parseInt(sourceParts.find(p => p.type === 'hour').value);
                const sourceMinute = parseInt(sourceParts.find(p => p.type === 'minute').value);
                
                // æ¯”è¾ƒæºæ—¶åŒºæ˜¾ç¤ºçš„æ—¶é—´å’Œè¾“å…¥çš„æ—¶é—´
                if (sourceYear === year && 
                    sourceMonth === month && 
                    sourceDay === day && 
                    sourceHour === hour && 
                    sourceMinute === minute) {
                    // æ‰¾åˆ°äº†æ­£ç¡®çš„UTCæ—¶é—´
                    break;
                }
                
                // è®¡ç®—éœ€è¦è°ƒæ•´çš„æ—¶é—´å·®ï¼ˆåˆ†é’Ÿï¼‰
                // å¦‚æœæºæ—¶åŒºæ˜¾ç¤ºçš„æ—¶é—´æ¯”è¾“å…¥çš„æ—¶é—´æ—©ï¼Œéœ€è¦å¢åŠ UTCæ—¶é—´
                const sourceDate = new Date(sourceYear, sourceMonth, sourceDay, sourceHour, sourceMinute);
                const inputDate = new Date(year, month, day, hour, minute);
                const diffMinutes = (inputDate.getTime() - sourceDate.getTime()) / 60000;
                
                // è°ƒæ•´UTCæ—¶é—´
                utcTime += diffMinutes * 60000;
                
                // å¦‚æœè°ƒæ•´å¾ˆå°ï¼Œå¯ä»¥æå‰é€€å‡º
                if (Math.abs(diffMinutes) < 1) {
                    break;
                }
            }
            
            return utcTime;
        }

        function convertTime(options = {}) {
            const silent = options.silent || false;
            const sourceCity = document.getElementById('source-city').value;
            const sourceDateInput = document.getElementById('source-date');
            const targetSelects = document.querySelectorAll('.target-city-select');
            const slider = document.getElementById('timeline-slider');
            
            if (!sourceCity) {
                if (!silent) alert('è¯·å…ˆé€‰æ‹©æºåŸå¸‚ï¼');
                return;
            }

            const targetCities = Array.from(targetSelects)
                .map(select => select.value)
                .filter(value => value !== '');

            if (targetCities.length === 0) {
                if (!silent) alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç›®æ ‡åŸå¸‚ï¼');
                const resultsDiv = document.getElementById('results');
                if (resultsDiv) {
                    resultsDiv.className = 'results';
                    resultsDiv.innerHTML = '';
                }
                return;
            }

            // è·å–æ—¥æœŸï¼ˆé»˜è®¤ä»Šå¤©ï¼‰
            const dateStr = sourceDateInput && sourceDateInput.value ? sourceDateInput.value : null;
            const baseDate = dateStr ? new Date(`${dateStr}T00:00:00`) : new Date();
            const year = baseDate.getFullYear();
            const month = baseDate.getMonth();
            const day = baseDate.getDate();

            // ä½¿ç”¨æ—¶é—´è½´ï¼ˆåˆ†é’Ÿï¼‰å¹¶å››èˆäº”å…¥åˆ°15åˆ†é’Ÿ
            const minutesOfDay = slider ? roundTo15(parseInt(slider.value, 10) || 0) : 0;
            const hour = Math.floor(minutesOfDay / 60);
            const minute = minutesOfDay % 60;

            updateTimelineDisplay(sourceCity, minutesOfDay);

            // å°†æºæ—¶åŒºçš„æœ¬åœ°æ—¶é—´è½¬æ¢ä¸ºUTCæ—¶é—´æˆ³
            const utcTime = sourceLocalTimeToUTC(year, month, day, hour, minute, sourceCity);
            const utcDate = new Date(utcTime);
            
            // ç»„åˆæº + ç›®æ ‡åŸå¸‚ï¼ˆæºåŸå¸‚ä¹Ÿå±•ç¤ºï¼‰
            const allCities = [sourceCity, ...targetCities.filter(c => c && c !== sourceCity)];

            // ä½¿ç”¨ Intl API è¿›è¡Œæ—¶åŒºè½¬æ¢
            const results = [];
            
            allCities.forEach(targetCity => {
                try {
                    // ç›´æ¥ä½¿ç”¨Intl.DateTimeFormatå°†UTCæ—¶é—´æ ¼å¼åŒ–ä¸ºç›®æ ‡æ—¶åŒºçš„æ—¶é—´
                    const targetFormatter = new Intl.DateTimeFormat('zh-CN', {
                        timeZone: targetCity,
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    });

                    const targetTimeStr = targetFormatter.format(utcDate);
                    const targetDateStr = new Intl.DateTimeFormat('zh-CN', {
                        timeZone: targetCity,
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        weekday: 'long'
                    }).format(utcDate);
                    
                    // è·å–ç›®æ ‡æ—¶åŒºçš„UTCåç§»é‡ç”¨äºæ˜¾ç¤º
                    const targetOffset = getTimezoneOffset(targetCity, utcDate);
                    const timezoneOffset = formatTimezoneOffset(targetOffset);
                    
                    results.push({
                        city: cityNames[targetCity] || targetCity,
                        time: targetTimeStr.replace(/\//g, '-'),
                        date: targetDateStr,
                        timezone: timezoneOffset
                    });
                } catch (error) {
                    console.error('è½¬æ¢é”™è¯¯:', error);
                    results.push({
                        city: cityNames[targetCity] || targetCity,
                        time: 'è½¬æ¢å¤±è´¥',
                        date: '',
                        timezone: ''
                    });
                }
            });

            // æ˜¾ç¤ºç»“æœ
            displayResults(results);
        }

        function getTimezoneOffset(timezone, date) {
            // ä½¿ç”¨Intl APIè·å–æ—¶åŒºåç§»
            // åˆ›å»ºä¸€ä¸ªæ ¼å¼åŒ–å™¨ï¼Œè·å–UTCå’ŒæŒ‡å®šæ—¶åŒºçš„æ—¶é—´éƒ¨åˆ†
            const utcFormatter = new Intl.DateTimeFormat('en', {
                timeZone: 'UTC',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            
            const tzFormatter = new Intl.DateTimeFormat('en', {
                timeZone: timezone,
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            
            // æ ¼å¼åŒ–æ—¥æœŸ
            const utcParts = utcFormatter.formatToParts(date);
            const tzParts = tzFormatter.formatToParts(date);
            
            // æå–æ—¶é—´éƒ¨åˆ†å¹¶è½¬æ¢ä¸ºæ—¶é—´æˆ³
            const getTimeValue = (parts) => {
                const y = parseInt(parts.find(p => p.type === 'year').value);
                const m = parseInt(parts.find(p => p.type === 'month').value) - 1;
                const d = parseInt(parts.find(p => p.type === 'day').value);
                const h = parseInt(parts.find(p => p.type === 'hour').value);
                const min = parseInt(parts.find(p => p.type === 'minute').value);
                const s = parseInt(parts.find(p => p.type === 'second').value);
                // ä½¿ç”¨UTCæ„é€ å‡½æ•°é¿å…æ—¶åŒºé—®é¢˜
                return Date.UTC(y, m, d, h, min, s);
            };
            
            const utcTime = getTimeValue(utcParts);
            const tzTime = getTimeValue(tzParts);
            
            // è®¡ç®—åç§»é‡ï¼ˆåˆ†é’Ÿï¼‰
            // tzTime - utcTime çš„å·®å€¼å°±æ˜¯æ—¶åŒºåç§»
            return (tzTime - utcTime) / 60000;
        }

        function formatTimezoneOffset(offsetMinutes) {
            const hours = Math.floor(Math.abs(offsetMinutes) / 60);
            const minutes = Math.abs(offsetMinutes) % 60;
            const sign = offsetMinutes >= 0 ? '+' : '-';
            if (minutes === 0) {
                return `UTC${sign}${hours}`;
            } else {
                return `UTC${sign}${hours}:${String(minutes).padStart(2, '0')}`;
            }
        }

        function roundTo15(minutes) {
            return Math.round(minutes / 15) * 15;
        }

        function minutesToHHMM(minutes) {
            const h = Math.floor(minutes / 60);
            const m = minutes % 60;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
        }

        function updateTimelineDisplay(sourceCity, minutesOfDay) {
            const display = document.getElementById('timeline-display');
            if (!display) return;
            const cityName = cityNames[sourceCity] || (sourceCity || 'æºåŸå¸‚');
            display.textContent = `${cityName} ${minutesToHHMM(minutesOfDay)}`;
        }

        function syncSliderWithSourceTime() {
            const sourceDateInput = document.getElementById('source-date');
            const slider = document.getElementById('timeline-slider');
            const sourceCity = document.getElementById('source-city').value;
            if (!slider) return;
            const now = new Date();
            const minutesNow = now.getHours() * 60 + now.getMinutes();
            const minutesOfDay = roundTo15(minutesNow);
            slider.value = minutesOfDay;
            updateTimelineDisplay(sourceCity, minutesOfDay);
            if (sourceDateInput && !sourceDateInput.value) {
                const y = now.getFullYear();
                const m = String(now.getMonth() + 1).padStart(2, '0');
                const d = String(now.getDate()).padStart(2, '0');
                sourceDateInput.value = `${y}-${m}-${d}`;
            }
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.className = 'results show';
            
            resultsDiv.innerHTML = results.map(result => `
                <div class="result-card">
                    <div class="result-city">${result.city}</div>
                    <div class="result-time">${result.time}</div>
                    <div class="result-date">${result.date}</div>
                    <div class="timezone-info">${result.timezone}</div>
                </div>
            `).join('');
        }

        // åˆå§‹åŒ–ï¼šè®¾ç½®é»˜è®¤æ—¥æœŸã€åŒæ­¥æ—¶é—´è½´ã€ç»‘å®šäº‹ä»¶
        window.onload = function() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const dateInput = document.getElementById('source-date');
            if (dateInput) {
                dateInput.value = `${year}-${month}-${day}`;
            }

            // åŒæ­¥æ—¶é—´è½´
            syncSliderWithSourceTime();

            // ç»‘å®šäº‹ä»¶ï¼šæ—¶é—´è½´å˜åŒ–æ—¶å®æ—¶è½¬æ¢
            const slider = document.getElementById('timeline-slider');
            if (slider) {
                slider.addEventListener('input', () => convertTime({ silent: true }));
            }

            // æ—¥æœŸæˆ–æºåŸå¸‚å˜åŠ¨æ—¶ï¼Œé‡æ–°åŒæ­¥æ—¶é—´è½´å¹¶è½¬æ¢
            const sourceDateInput = document.getElementById('source-date');
            const sourceCitySelect = document.getElementById('source-city');
            if (sourceDateInput) {
                sourceDateInput.addEventListener('change', () => {
                    syncSliderWithSourceTime();
                    convertTime({ silent: true });
                });
            }
            if (sourceCitySelect) {
                sourceCitySelect.addEventListener('change', () => {
                    syncSliderWithSourceTime();
                    convertTime({ silent: true });
                });
            }

            // é¦–æ¬¡è½¬æ¢ä»¥å±•ç¤ºåˆå§‹å€¼
            convertTime({ silent: true });
        };
    </script>
</body>
</html>
